# System Design социальной сети для курса по System Design

## Требования

### Функциональные требования

#### Публикация постов

- Загрузка фотографий (поддержка форматов JPEG, PNG, WebP), максимум 5.
- Добавление текстового описания (до 500 символов).
- Привязка к геолокации.

#### Реакции и комментарии

- Лайки/дизлайки.
- Комментирование.
- Сортировка комментариев по времени и популярности.

#### Подписки

- Подписка/отписка от пользователей.
- Уведомления о новых постах подписок.
- Отображение списка подписок и подписчиков.

#### Поиск и рекомендации

- Поиск мест по названию, тегам или геолокации.
- Топ популярных мест (на основе количества постов и реакций).
- Фильтрация постов по локациям.

#### Ленты

- Пагинация по 5 постов.
- Персональная лента подписок (обратный хронологический порядок).
- Общая лента популярных постов (алгоритмическая выдача).

### Нефункциональные требования

- Поддержка 10 млн DAU с линейным ростом;
- Доступность 99.9%
- Аудитория стран СНГ;
- Мобильное устройство и браузер;

## Оценка нагрузки

| Подсистема           | RPS   | Суточный объем | Трафик (Мбит/с) |
|----------------------|-------|----------------|-----------------|
| Посты                |       |                |                 |
| Публикация постов    | 12    | 1.37 ГБ        | ≈ 0.13          |
| Пресайнд URL (S3)    | 12    | 1 ГБ           | ≈ 0.1           |
| Просмотр постов      | 1 621 | 1.12 TБ        | ≈ 104           |
|                      |       |                |                 |
| Комментарии          |       |                |                 |
| Оставить комментарий | 17    | 1.55 ГБ        | ≈ 0.136         |
| Показать комментарии | 2 893 | 3 TБ           | ≈ 287           |
|                      |       |                |                 |
| Реакции              | 1 157 | 3.3 ГБ         | ≈ 0.3           |
| Подписки             | 58    | 160 МБ         | ≈ 0.015         |
|                      |       |                |                 |
| CDN                  | 4 526 | 1.2 ПБ         | ≈ 112 650       |

### Публикация постов

- *10% пользователей публикуют по 1 посту в день*

```
author_id - 16 байт
photos - 300 байт
description - 1000 байт
geo - 58 байт
```

- RPS = 1 000 000 / 84 600 ≈ 12
- Traffic = 12 * (16 + 300 + 1000 + 58) = 16.5 кБ/с = 0.13 Мбит/с

#### Пресайнд URL (S3)

```
key - 100 байт
url - 100 байт
```

- Traffic = 12 * 5 * 200 = 12 кБ/c = 0.1 Мбит/с

### Просмотр постов

- *Каждый пользователь просматривает 50 постов в день ленты*
- *Каждый пользователь просматривает 20 постов в день поиска*

```
post_id - 16 байт
author_id - 16 байт
username - 100 байт
avatar 100 байт
photos - 300 байт
description - 1000 байт
geo - 58 байт
likes - 4 байт
comments - 4 байт
is_liked - 1 байт
is_subscribed - 1 байт
created_at - 8 байт
```

- RPS = 140 000 000 / 86 400 = 1 621
- Traffic = 1 621 * 5 * 1608 = 13 032 кБ/с = 104 Мбит/с

### Реакции

- *Каждый пользователь ставит 10 реакций в день*

```
user_id - 16 байт
post_id - 16 байт
is_like - 1 байт
```

- RPS = 100 000 000 / 86 400 = 1 157
- Traffic = 1 157 * 33 = 38 кБ/с = 0.3 Мбит/с

### Оставить комментарий

- *5% пользователей пишут по 3 комментария в день*

```
user_id - 16 байт
post_id - 16 байт
text - 1000 байт
```

- RPS = 1 500 000 / 86 400 = 17 
- Traffic = 17 * 1 032 = 17 кБ/с = 0.136 Мбит/с

### Показать комментарии

- *Пользователи открывают комментарии только к 30% просмотренных постов (15 из 50).*
- *Из них 20% запрашивают вторую пачку комментариев.*

```
user_id - 16 байт
username - 100 байт
avatar 100 байт
post_id - 16 байт
text - 1000 байт
create_at - 8 байт
```

21 (первые пачки) + 4 (пагинация)= 25 запросов.

- RPS = (10 000 000 * 25) / 86 400 = 2 893
- Traffic = 2 893 * 10 * 1 240 = 35 873 кб/с = 287 Мбит/с

### Подписки

- *5% пользователей совершают 10 действий с подписками в день*

```
author_id - 16 байт
subscriber_id - 16 байт
```

- RPS = 5 000 000 / 86 400 = 58
- Traffic = 58 * 32 = 1 856 байт/с = 0.015 Мбит/с

### CDN

- Публикация постов - **12 RPS** - 3 фото в среднем по 2 Мбайта
- Просмотр постов (пагинация по 5)
  - Посты - **1 621 RPS** - 3 фото в среднем по 0.5 Мбайт (cжатие)
  - Аватарки - **1 621 RPS** одно фото по 0.05 Мбайт
- Комментарии (пагинация по 10) - **2 893 RPS** одно фото по 0.05 Мбайт


- RPS = 12 + 1 621 + 2 893 = 4 526
- Traffic = (12 * 3 * 2) + (1 621 * 5 * 3 * 0.5) + (1 621 * 5 * 0.05) + (2 893 * 10 * 0.05) = 14 081 Мбайт/с = 112 650 Мбит/с

### Connections

10 000 000 * 0.1 = 1 000 000
